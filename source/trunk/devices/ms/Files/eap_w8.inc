!include "common.nsh"
;===========================
;TRANSLATION
Section "<?php echo _("Installation of the personal certificate")?>" cert
!insertmacro MUI_HEADER_TEXT "<?php echo _("Components installation")?>" "<?php echo _("Personal certificate")?>"
SectionEnd
;==========================
;TRANSLATION
Section "<?php echo _("Installation of network profiles")?>" "<?php echo _("profiles")?>"
SectionIn RO
!insertmacro MUI_HEADER_TEXT "<?php echo _("Installation")?>" "<?php echo _("Network profiles update")?>"
File "w8/*lan_prof*.xml"


${If} $wireless_result == 0
Call CheckWirelessProfiles
Call CreateWirelessProfiles 
${EndIf}

${If} $wired == 1
  Call CreateLanProfile
${EndIf}
!ifdef CRED
  Call InstallUserCredentials
!endif
;Sleep 2000
SendMessage $HWNDPARENT "0x408" "1" ""
Sleep 2000
SectionEnd
;==========================
Section "-koncowka"
!ifdef CA_CERT
Delete "$TEMP\${CA_CERT}"
!endif
!ifdef EXTERNAL_INFO
  Call displayExternalInfo
!endif
SectionEnd
;==========================


;----------------------------
; Functions which need to defined after sections
!ifdef TLS
Function .onSelChange
  SectionGetFlags ${cert} $PFX_install
FunctionEnd

Function showComponents
  !ifdef TLS_CERT_STRING
  FileOpen $9 check_pfx.cmd w
  FileWrite $9 '@certutil -user -store my | find "${TLS_CERT_STRING}"'
  FileClose $9
  nsExec::Exec "$TEMP\check_pfx.cmd"
  !else
  Push 1
  !endif
  Pop $PFX_install
  ${If} $PFX_install == 0
    SectionSetFlags ${cert} 0
  ${Else}
    SectionSetFlags ${cert} 1
  ${EndIf}

;TRANSLATION
  !insertmacro MUI_HEADER_TEXT "<?php echo _("Information about components")?>" " "
FunctionEnd
!endif
